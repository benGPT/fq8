{% extends "base.html" %}
{% block content %}
{% if romn_compliance %}
    <p>You have already submitted the ROMN Compliance document on {{ romn_compliance.submission_date.strftime('%Y-%m-%d %H:%M:%S') }}.</p>
    <a href="{{ url_for('download_romn_compliance', compliance_id=romn_compliance.id) }}" class="bg-green-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Download ROMN Compliance Document</a>
{% else %}
<div class="max-w-2xl mx-auto bg-white p-8 rounded shadow">
    <h2 class="text-2xl font-bold mb-4">Nurse ROMN Compliance Document</h2>
    <form method="POST" class="space-y-4" id="romnForm">
        <div>
            <p class="mb-4">Please read the following ROMN Compliance Document carefully:</p>
            <div class="policy-document border p-4 mb-4">
                <p>This is the ROMN compliance document that you are agreeing to...</p>
            </div>
        </div>
        <div>
            <label for="signatureCanvas" class="block text-sm font-medium text-gray-700 mb-2">Please sign below:</label>
            <canvas id="signatureCanvas" width="500" height="200" class="border border-gray-300"></canvas>
            <input type="hidden" id="signatureData" name="signature" required>
        </div>
        <button type="button" id="clearSignature" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">Clear Signature</button>
        <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Submit ROMN Compliance</button>
    </form>
</div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    var canvas = document.getElementById('signatureCanvas');
    var ctx = canvas.getContext('2d');
    var drawing = false;
    var lastX, lastY;

    function startDrawing(e) {
        drawing = true;
        [lastX, lastY] = [e.offsetX, e.offsetY];
    }

    function draw(e) {
        if (!drawing) return;
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
        [lastX, lastY] = [e.offsetX, e.offsetY];
    }

    function stopDrawing() {
        drawing = false;
    }

    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);

    document.getElementById('clearSignature').addEventListener('click', function() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    });

    document.getElementById('romnForm').addEventListener('submit', function(e) {
        var signatureData = canvas.toDataURL();
        document.getElementById('signatureData').value = signatureData;
    });
});
</script>
{% endblock %}

